// Code generated by xgendao. DO NOT EDIT.
// source: {{.DaoName}}.go

// --------------------------------------------------
// File Name: base {{.Fileinfo.Filename}}.go
// Author: {{.Fileinfo.Author}}
// Created Time: {{.Fileinfo.CreateTime}}
// ---------------------说明--------------------------
// {{.Fileinfo.DescribeInfo}}
// ---------------------------------------------------

package base{{.Common.PkgName}}

import (
"fmt"
xdao "{{.Common.ProjectName}}/dao/base"
entity "{{.Common.ProjectName}}/{{.Common.EntityPath}}"
"github.com/jinzhu/gorm"
)

type Base{{.DaoName}}Dao struct {
opts *xdao.ProjectDaoOptions
Db   *gorm.DB
}

{{/*opts ...xdao.ProjectDaoOption*/}}
func NewBase{{.DaoName}}Dao() *Base{{.DaoName}}Dao {

defopts := &xdao.ProjectDaoOptions{

}
dao := &Base{{.DaoName}}Dao{
opts: defopts,
}
{{/*dao.Init(opts...)*/}}
return dao
}

func (d *Base{{.DaoName}}Dao) Init(opts ...xdao.ProjectDaoOption) {
var defopts *xdao.ProjectDaoOptions
defopts = d.opts
if defopts == nil {
defopts = &xdao.ProjectDaoOptions{}
}
for _, x := range opts {
if e := x(defopts); e != nil {
panic(e)
}
}
if e := d.init(); e != nil {
panic(e)
}
}

func (d *Base{{.DaoName}}Dao) init() error {
bdao := d.opts.Dao
if bdao==nil{
return fmt.Errorf("xdao not init")
}
_x := &entity.{{.DaoName}}{}
basedb, err := bdao.InitTableSchema(_x)
if err != nil {
return fmt.Errorf("初始化表实例{%v}失败==>%v  \n", _x, err)
}
//
if ormdb, ok := basedb.(*xdao.BaseGormDB); ok {
db, err := ormdb.GetGormDB()
if err != nil {
return err
}
d.Db = db
}
return nil
}

// 保存
func (this *Base{{.DaoName}}Dao) SaveEntity(e entity.{{.DaoName}}) (newone *entity.{{.DaoName}}, err error) {
d := this.Db.Save(&e)
return &e, d.Error
}

// 插入
func (this *Base{{.DaoName}}Dao) InsertEntity(e entity.{{.DaoName}}) (newone *entity.{{.DaoName}}, err error) {
    d := this.Db.Create(&e)
    return &e, d.Error
}

// 删除
func (this *Base{{.DaoName}}Dao) DeleteEntity(e entity.{{.DaoName}}, where entity.{{.DaoName}}) (int64, error) {
    d := this.Db.Where(where).Delete(e)
    return d.RowsAffected, d.Error
}

// 根据id获取一条记录
func (this *Base{{.DaoName}}Dao) Get(id uint) (*entity.{{.DaoName}}, error) {
    s := entity.{{.DaoName}}{}
    e := this.Db.Where("id=?", id).Find(&s).Error
    return &s, e
}

// 根据uuid获取一条记录
func (this *Base{{.DaoName}}Dao) GetUuid(uuid string) (*entity.{{.DaoName}}, error) {
    s := entity.{{.DaoName}}{}
    e := this.Db.Where("uuid=?", uuid).Find(&s).Error
    return &s, e
}

func (this *Base{{.DaoName}}Dao) copyFromDb(db *gorm.DB) *Base{{.DaoName}}Dao {
return &Base{{.DaoName}}Dao{
opts: this.opts,
Db:   db,
}
}

// 事物处理
func (this *Base{{.DaoName}}Dao) Transaction(f func(db *Base{{.DaoName}}Dao) error) error {
db := this.Db.Begin()
dao := this.copyFromDb(db)
e := f(dao)
if e != nil {
if e2 := db.Rollback().Error; e2 != nil {
return e2
}
return e
} else {
return db.Commit().Error
}
}
